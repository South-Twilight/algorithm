## 旋转

### 1.2D中的旋转--复数

复数的矩阵表示： 

$ z = a + bi \ = \ \begin{bmatrix} a&-b\\ b&a\end{bmatrix} \ = \ |z|*I* \begin{bmatrix} cos\theta & -sin\theta\\ sin\theta & cos\theta \end{bmatrix}$



最后那个三角函数的矩阵就是2D平面上的旋转

![image-20210907155535419](C:\Users\12149\AppData\Roaming\Typora\typora-user-images\image-20210907155535419.png)

$ x = r\cos\alpha, y = r\sin\alpha$

$x'=r\cos(\alpha+\theta),y'=r\sin(\alpha+\theta)$

得到：

$x'=x\cos\theta-y\sin\theta$

$y'=x\sin\theta+y\cos\theta$

$\begin{bmatrix} x' \\ y' \end{bmatrix} = \begin{bmatrix} cos\theta & -sin\theta \\ sin\theta & cos\theta \end{bmatrix}\begin{bmatrix} x \\ y \end{bmatrix}$



任何复数 $c$ 和 $z$ 相乘，就是将 $c$ 逆时针旋转 $\theta$ 度，并将其缩放 $|z|$ 倍。

$ v'=zv=(\cos\theta+i\sin\theta)v=e^{i\theta}v $

$v'=e^{i(\theta_1+\theta_2)}$ 表示先旋转 $\theta_1$ 再旋转 $\theta_2$ 



### 2.3D中的旋转--罗德里格旋转公式

![image-20210907170821347](C:\Users\12149\AppData\Roaming\Typora\typora-user-images\image-20210907170821347.png)

推导过程分解为平行和垂直 $u$ 两部分，然后平行的部分保持不变，垂直的部分转换为二维平面做（二维平面的基为 $v_{\perp}$ 和 $w=u\cross v_{\parallel}$ ），利用二维平面旋转公式即可。

其中：

$v_{\parallel}=(u*v)*u$ ，其中 $|u|=1$

$v_{\perp}=v-v_{\parallel}$ 

最后得到公式：

$v'=v\cos\theta + (u*v)u(1-\cos\theta) + (u \cross v) \sin\theta$



## 一些题目中常用的性质：

1.

**内公切线**：两个图形分别在公切线的两侧；

**外公切线**：两个图形分别在公切线同侧；

两个三角形不相交，则一定可以做出两条内公切线。

2.

以整点为顶点的线段，如果 $dx$ 和 $dy$ 都不为0，经过的格点数为 $gcd(dx,dy)+1$ 。

  

## 二维计算几何基础

### 图形记录

点：pair

向量：pair

线：直线上一点 + 方向向量

线段：左右端点

多边形：数组顺序记录每个点

曲线：解析式（特别的，对于圆，记录圆心和半径）



### 基本公式

正弦定理、余弦定理



### 基本操作 

##### 判断点 $Q$ 在直线（点 $P$ ，方向向量 $v$ ）哪边：

利用向量积性质，$\vec{PQ} \cross \boldsymbol{v}$ ，向量积为负数，则 $Q$ 在直线上方，正数则在直线下方。

向量积：右手定则，旋转出来垂直纸面向上则为正，反之为负数。

##### 快速排斥实验与跨立实验（两条线段是否相交）：

平行（斜率）、重合（三点共线）

快速排斥实验：每条线段所代表的的矩形区域是否相交

![image-20210907203135931](C:\Users\12149\AppData\Roaming\Typora\typora-user-images\image-20210907203135931.png)

跨立实验：线段 $a$ 的两点是否在直线 $b$ 的两侧，线段 $b$ 的两点是否在直线 $a$ 的两侧



##### 判断点是否在任意多边形内：

a). 光线投射算法：

先解决特殊情况---点离多边形太远（四个最极端的坐标得到的矩形外），在边界上（依次判断点是否在线段上）。

然后考虑普遍的情况，随机取一条射线，如果与多边形有奇数个交点，则在多边形内部；偶数个则在多边形外。

b). 回转数算法：

该点与多边形所有点连起来，计算相邻两边夹角的和（有方向），夹角和为 $0$ ，则在多边形外。



##### 求两直线的交点

首先用向量判断平行；

现在直线上的一个点与直线的方向向量，只需要知道要平移多少个单位长度到交点即可。

$P$ , $\vec{a}$ ; $Q$ , $\vec{b}$ ；$\vec{u} = \vec{PQ}$ 

$|a \cross b|=|a||b| \sin\theta $ , $|u \cross b|=|u||b|\sin\theta$

作商：

$T = \frac{|u \cross b|}{|a \cross b|} = \frac{|u|\sin\theta}{|a|\sin\beta}$ ，如果为正，则表示沿 $\vec{a}$ 方向平移，反之就反方向。

最后将 $P$ 加上 $T \vec{a}$ 就得到了交点。

![image-20210907210921739](C:\Users\12149\AppData\Roaming\Typora\typora-user-images\image-20210907210921739.png)



##### 求任意多边形的周长和面积：

a). 周长：

直接计算

b). 面积：

向量积的模的几何意义：$|\vec{AB} \cross \vec{AC}| = 2 * S_{\triangle ABC}$ 

多边形上的点逆时针标记为：$p_1, p_2, ... , p_n$ ，再选定任意一个辅助点 $O$ ，记向量 $\vec{v_i} = p_i - O$  ，则多边形的面积可以表示为：

$S = \frac{1}{2}|\sum_{i=1}^{i=n} \boldsymbol{v_i} \cross \boldsymbol{v_{(i+1 \mod n) + 1}}|$  

$S_{\triangle ABC}=\sqrt{p(p-a)(p-b)(p-c)}, \ p=\frac{a+b+c}{2}$ 



##### 圆与直线相关：

判断位置；

相离：

相切：求出切点，转为切点与半径连线和切线的交点

相交：勾股定理求两交点的中点，沿直线方向加上半弦长



##### 求两圆交点：

判断位置；

相离：

相切：两圆心连线的方向向量，平移半径的距离

相交：交点与一圆心相连，计算直线与两圆心连线夹角，进行旋转得到直线方向向量，再将圆心沿方向向量平移半径距离



##### 极角序

先枚举一个极点，计算其他点的极坐标，在极坐标下按照极角的顺序解决问题。



## 距离

**欧几里得距离**： $|AB|=\sqrt{(x_2-x_1)^2+(y_2-y_1)^2}$

**曼哈顿距离**：$d(A,B)=|x_2-x_1|+|y_2-y_1|$ ，$d(i,j) <= d(i,k)+d(k,j)$

**切比雪夫距离**：$d(A,B) = \max(|x_1-x_2|,|y_1-y_2|)$

##### 曼哈顿距离与切比雪夫距离的互相转化：

$(x,y)$ 的曼哈顿距离 = $(x+y, x-y)$ 的切比雪夫距离；

$(x,y)$ 的切比雪夫距离 = $(\frac{x+y}{2},\frac{x-y}{2})$ 的曼哈顿距离；

曼哈顿坐标系是通过切比雪夫坐标系旋转 $45 \degree$ 后，再缩小一半得到的；

 **$L_m$ 距离**：

$d(L_m)=(|x_1-x_2|^m + |y_1-y_2|^m)^{\frac{1}{m}}$ 

其中 $L_1$ 是曼哈顿距离，$L_2$ 是欧几里得距离

**汉明距离**：两个字符串之间的距离，表示两个相同长度的字符串对应位字符不同的数量。



## Pick定理：

##### 定理：

给定**顶点**均为**整点**的简单多边形，$pick$ 定理说明了其面积 $A$ 和**内部格点**数目 $i$ 、**边上格点**数目 $b$ 的关系：$A = i + \frac{b}{2}-1$ 

##### 推广：

1.取格点的组成图形的面积为一单位。在平行四边形格点，$pick$ 定理依然成立。套用于任意三角形格点，则是 $A=2 \cross i + b - 2$ 。

2.对于非简单的多边形 $P$ ，$pick$ 定理 $A=i+\frac{b}{2}-\chi(P)$ , $\chi(P)$ 表示 $P$ 的欧拉特征数

3.高维推广：$Ehrhart$ 多项式

4.$pick$ 定理和欧拉公式($V-E+F=2$，$V$ 表示点数，$E$ 表示边数，$F$ 表示面数)等价



## 凸包：

##### 凸多边形定义：

所有内角在 $[0, \pi]$ 范围内的简单多边形

#####  凸包定义：

在平面上能包含所有给定点的最小凸多边形；

也可以说：对于给定集合 $X$ ，所有包含 $X$ 的凸集的交集 $S$ 被称为 $X$ 的凸包。



凸包用最小的周长围住了给定的所有点，凹多边形一定不行（三角不等式）



##### Andrew算法求凸包：

双关键字排序（横坐标，纵坐标），最大和最小元素一定在凸包中；

从一个点出发逆时针走，轨迹一定是左拐，一旦右拐这说明这一段不在凸包上。可以用一个单调栈维护上下凸壳；

从左往右看，上下凸壳旋转方向不同；使用升序求下凸壳，降序求上凸壳。

求凸壳时，一旦发现即将进栈的点 $P$ 和栈顶的两个点 $S_1, S_2$ （其中 $S_1$ 为栈顶）有 $ \vec{S_2 S_1} \cross \vec{S_1 P}<0$ ，则一直弹出栈顶至满足$ \vec{S_2 S_1} \cross \vec{S_1 P}>=0$或仅剩下一个元素。

通常情况下，不需要保留凸包边上的点，因此上式中的 $<$ 可以替换为 $<=$ ，后面的 $>=$ 可以替换为 $>$ 。



## 扫描线

离散化；

纵坐标从下往上扫，扫到下边界给横坐标对应区间 $+1$ ，扫到上边界给对应区间 $-1$ 。如果对应点的值大于0，说明该横坐标在这段纵坐标范围内仍然后贡献；反之，说明没有贡献。



## 旋转卡壳

##### 求凸包的直径：

求出凸包后，枚举边，对每条边找离它最远的点，那么可以满足边在旋转的同时，点也在旋转。（类似two-pointer)

用叉积算面积，来判断距离

##### 最小矩形覆盖：

采用上题类似的思路，搞定凸包后，旋转枚举边，维护三个点：直接对面的点，两个在不同侧面的点。

最优点用叉积来算；（矩形的一边）

另外一条边则可以通过两个不同侧点与枚举边的点积（也就是投影）相加，再加上枚举边的长度得到。

最后可以用以下式子表示出来：

边 $AB$ ，最远点 $C$ ，两侧点 $D,E$ 

$S=\frac{|\vec{AC} \cross \vec{BC}|}{|\vec{AB}|} * (|\vec{AD}*\vec{AB}|+|\vec{BE}*\vec{AB}|+|\vec{AB}|)$



## 闵可夫斯基和





## 圆的反演

定义：

> 给定反演中心 $O'$ 和反演半径 $R$ 。若平面上点 $P'$ 和 $P$ 满足：
>
> - 点 $P'$ 在射线 $\vec{OP}$ 上
> - $|OP| * |OP'| = R^2$
>
> 则称 $P$ 和 $P'$ 互为反演点。



性质：

1. 圆 $O$ 外的点的反演点在圆内，圆内点的反演点在圆外。

2. 不过点 $O$ 的圆 $A$ ，其反演图形 $B$ 也不过圆 $O$ ，且 $B$ 也是圆

   满足 $r_B=\frac{1}{2} (\frac{1}{|OA|-r_A}-\frac{1}{|OB|-r_A})$ 

3. 过点 $O$ 的圆 $A$ ，其反演图形时不过点 $O$ 的直线（无限接近点 $O$ ，则反演点无限远离点 $O$ )
4. **两个图形相切，则他们的反演图形也相切 ** 

